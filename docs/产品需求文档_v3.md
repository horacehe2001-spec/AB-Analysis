# 统计分析平台 - 产品需求文档

---

## 1. 文档信息

| 项目       | 内容                     |
| ---------- | ------------------------ |
| 文档名称   | 统计分析平台产品需求文档 |
| 版本号     | V3.0                     |
| 发布日期   | 2026-01-31               |
| 文档状态   | 正式发布                 |

---

## 2. 产品概述

本平台是一款面向工业质量与数据分析场景的统计分析工具，旨在为用户提供从数据上传、统计检验、过程控制到报告导出的一站式分析体验。平台内置多种统计方法，支持自动化方法选择，并可选接入大语言模型（LLM）实现意图提取、方案生成与结论综合等智能辅助功能。

**核心定位：**

- 降低统计分析门槛，让非统计专业人员也能完成专业级分析
- 覆盖假设检验、SPC 控制图、过程能力分析、稳定性分析四大模块
- 支持多行业分类（共 9 个行业），适配不同领域的分析需求
- 提供深色主题 UI，保障长时间使用的视觉舒适度

---

## 3. 功能模块

### 3.1 数据上传与预处理

**模块状态：** 已实现

#### 功能描述

用户可通过文件上传的方式将待分析数据导入平台。系统自动完成文件解析、编码检测与数据预处理，为后续分析模块提供结构化数据。

#### 支持的文件格式

| 格式   | 扩展名       | 说明                       |
| ------ | ------------ | -------------------------- |
| CSV    | `.csv`       | 逗号分隔值文件             |
| TXT    | `.txt`       | 文本文件（支持自定义分隔符）|
| Excel  | `.xlsx/.xls` | Microsoft Excel 工作簿     |

#### 编码检测

- 自动检测文件编码格式
- 中文文件默认优先采用 **GB18030** 编码解析，确保中文字符正确显示
- 支持 UTF-8、GBK 等常见编码的自动识别与回退

#### 用户流程

1. 用户在分析页面点击「上传文件」按钮
2. 选择本地 CSV、TXT 或 Excel 文件
3. 系统自动检测文件编码并解析数据
4. 系统展示数据预览（前若干行），用户确认数据无误
5. 数据进入待分析状态，可供后续模块调用

#### 验收标准

- [ ] 支持上传 CSV、TXT、Excel 三种格式文件
- [ ] 中文文件（GB18030 编码）能够正确解析，不出现乱码
- [ ] 上传完成后展示数据预览，包含列名与前 N 行数据
- [ ] 文件格式不支持时给出明确错误提示
- [ ] 大文件上传时有进度指示，不阻塞 UI

---

### 3.2 假设检验分析

**模块状态：** 已实现

#### 功能描述

假设检验模块提供 **8 种以上** 统计方法，覆盖参数检验与非参数检验。用户通过 6 步引导式流程完成分析，系统可根据数据特征自动推荐合适的检验方法。此外，模块支持多变量「影响因子」分析，帮助用户识别关键影响变量。

#### 统计方法清单

| 序号 | 方法名称              | 类型       | 适用场景                           |
| ---- | --------------------- | ---------- | ---------------------------------- |
| 1    | t 检验（t-test）      | 参数检验   | 单样本或两独立样本均值比较         |
| 2    | 配对 t 检验（Paired t-test） | 参数检验 | 配对样本均值差异检验             |
| 3    | Mann-Whitney U 检验   | 非参数检验 | 两独立样本分布比较（非正态数据）   |
| 4    | 方差分析（ANOVA）     | 参数检验   | 多组均值比较                       |
| 5    | Kruskal-Wallis 检验   | 非参数检验 | 多组分布比较（非正态数据）         |
| 6    | 卡方检验（Chi-square）| 非参数检验 | 分类变量独立性/拟合优度检验        |
| 7    | Pearson 相关分析      | 参数检验   | 两连续变量线性相关性分析           |
| 8    | Spearman 秩相关分析   | 非参数检验 | 两变量单调关系分析（非正态数据）   |
| 9    | 线性回归（Linear Regression） | 参数方法 | 因变量与自变量的线性关系建模 |

#### 自动方法选择机制

- 系统根据用户选定的变量类型（连续型/分类型）和数据分布特征自动推荐方法
- **正态性检验：** 采用 Shapiro-Wilk 检验判断数据是否服从正态分布
  - 若数据服从正态分布，推荐参数检验方法（如 t 检验、ANOVA）
  - 若数据不服从正态分布，推荐非参数检验方法（如 Mann-Whitney U、Kruskal-Wallis）

#### 变量选择器

- 提供变量选择对话框，用户可从数据集中选取 X 变量（自变量）和 Y 变量（因变量）
- 支持多变量选择，用于影响因子分析
- 系统根据变量组合自动匹配可用的检验方法

#### 可视化图表

| 图表类型   | 用途                           |
| ---------- | ------------------------------ |
| 散点图     | 展示两变量间的关系             |
| 箱线图     | 展示各组数据的分布特征         |
| 柱状图     | 展示分类变量的频次或均值对比   |
| 分布图     | 展示数据的分布形态             |
| 残差图     | 展示回归模型的残差分布         |

#### 6 步分析流程

1. **选择分析目标** — 用户描述分析意图或选择预设分析场景
2. **上传/选择数据** — 上传新数据或选择已有数据集
3. **选择变量** — 通过变量选择器指定 X/Y 变量
4. **方法推荐与确认** — 系统自动推荐统计方法，用户确认或手动调整
5. **执行分析** — 系统运行选定的统计方法并生成结果
6. **查看结果与报告** — 展示统计指标、可视化图表及文字结论

#### 多变量影响因子分析

- 支持同时选择多个 X 变量对单一 Y 变量进行影响程度分析
- 系统逐一或综合评估各 X 变量与 Y 变量的关联强度
- 结果以排序列表或图表形式展示各因子的影响程度

#### 验收标准

- [ ] 全部 9 种统计方法可正常执行并返回正确结果（p 值、统计量等）
- [ ] Shapiro-Wilk 正态性检验结果正确，并据此自动推荐合适的方法
- [ ] 变量选择器可正确列出数据集中的所有列，支持 X/Y 变量选定
- [ ] 6 步流程引导完整，用户可在任意步骤前进或回退
- [ ] 5 种可视化图表（散点图、箱线图、柱状图、分布图、残差图）均可正确渲染
- [ ] 影响因子分析支持多变量选择，结果展示清晰有序

---

### 3.3 SPC 控制图分析

**模块状态：** 已实现

#### 功能描述

SPC（统计过程控制）控制图模块提供 **7 种控制图** 类型，覆盖计量型与计数型数据场景。系统内置 **8 条 Western Electric 判异规则**，能够自动检测过程中的异常模式。用户通过 5 步流程完成控制图分析，系统可根据数据特征自动推荐合适的控制图类型。

#### 控制图类型

| 序号 | 图表类型   | 数据类型 | 适用场景                             |
| ---- | ---------- | -------- | ------------------------------------ |
| 1    | IX-MR 图   | 计量型   | 单值-移动极差控制图，适用于单次测量  |
| 2    | Xbar-R 图  | 计量型   | 均值-极差控制图，子组容量 2~10       |
| 3    | Xbar-S 图  | 计量型   | 均值-标准差控制图，子组容量 > 10     |
| 4    | P 图       | 计数型   | 不合格品率控制图，子组容量可变       |
| 5    | NP 图      | 计数型   | 不合格品数控制图，子组容量固定       |
| 6    | C 图       | 计数型   | 缺陷数控制图，检验单位固定           |
| 7    | U 图       | 计数型   | 单位缺陷数控制图，检验单位可变       |

#### Western Electric 8 条判异规则

| 规则编号 | 规则描述                                           |
| -------- | -------------------------------------------------- |
| 规则 1   | 1 个点落在控制限（3σ）之外                         |
| 规则 2   | 连续 9 个点落在中心线同一侧                        |
| 规则 3   | 连续 6 个点递增或递减                              |
| 规则 4   | 连续 14 个点交替上下波动                           |
| 规则 5   | 连续 3 个点中有 2 个点落在 2σ 与 3σ 之间（同侧）  |
| 规则 6   | 连续 5 个点中有 4 个点落在 1σ 与 3σ 之间（同侧）  |
| 规则 7   | 连续 15 个点落在 1σ 范围内（中心线两侧）          |
| 规则 8   | 连续 8 个点落在 1σ 范围之外（中心线两侧）         |

#### 自动控制图类型选择

- 系统根据数据类型（计量型/计数型）和子组设置自动推荐合适的控制图类型
- 用户也可手动指定控制图类型

#### 变量选择器（SPC 模式）

- SPC 模式下变量选择器支持仅选择 Y 变量（被监控的质量特性）
- 无需指定 X 变量，系统以数据序列顺序或时间字段作为横轴

#### 5 步分析流程

1. **上传/选择数据** — 上传新数据或选择已有数据集
2. **选择变量** — 通过变量选择器指定 Y 变量（质量特性列）
3. **图表类型推荐与确认** — 系统自动推荐控制图类型，用户确认或手动调整
4. **执行分析** — 系统计算控制限、绘制控制图并应用判异规则
5. **查看结果与报告** — 展示控制图、异常点标注及判异规则触发情况

#### 验收标准

- [ ] 7 种控制图均可正确绘制，控制限（UCL、CL、LCL）计算准确
- [ ] 8 条 Western Electric 判异规则均已实现，异常点在图表上有明确标注
- [ ] 自动控制图类型选择功能正常，推荐结果合理
- [ ] SPC 模式变量选择器支持仅选 Y 变量
- [ ] 5 步流程引导完整，用户可在任意步骤前进或回退
- [ ] 控制图支持交互操作（如缩放、悬停查看数据点详情）

---

### 3.4 过程能力分析

**模块状态：** 规划中（Placeholder）

#### 功能描述

过程能力分析模块用于评估制造过程满足规格要求的能力。模块将计算核心过程能力指标，帮助用户量化过程表现并识别改进方向。

#### 计划实现的能力指标

| 指标 | 名称         | 说明                                     |
| ---- | ------------ | ---------------------------------------- |
| Cp   | 过程能力指数 | 衡量过程的潜在能力（不考虑偏移）         |
| Cpk  | 修正过程能力指数 | 衡量过程的实际能力（考虑偏移）       |
| Pp   | 过程性能指数 | 基于整体标准差的过程性能（不考虑偏移）   |
| Ppk  | 修正过程性能指数 | 基于整体标准差的过程性能（考虑偏移） |

#### 用户流程（规划）

1. 上传/选择数据
2. 选择质量特性变量
3. 输入规格限（USL、LSL）
4. 系统计算 Cp、Cpk、Pp、Ppk 并生成过程能力报告
5. 展示过程能力直方图与正态拟合曲线

#### 验收标准（规划）

- [ ] 正确计算 Cp、Cpk、Pp、Ppk 四项指标
- [ ] 支持用户输入上规格限（USL）和下规格限（LSL）
- [ ] 生成过程能力直方图，叠加正态分布拟合曲线和规格限标线
- [ ] 提供过程能力等级判定（如 Cpk ≥ 1.33 为合格）

---

### 3.5 稳定性分析

**模块状态：** 规划中（Placeholder）

#### 功能描述

稳定性分析模块用于检测过程数据随时间变化的趋势和漂移，帮助用户判断过程是否处于稳定受控状态。

#### 计划实现的分析功能

| 功能         | 说明                                           |
| ------------ | ---------------------------------------------- |
| 趋势检测     | 检测数据中是否存在显著的上升或下降趋势         |
| 漂移分析     | 检测过程均值或方差是否发生漂移                 |

#### 用户流程（规划）

1. 上传/选择数据
2. 选择待分析的质量特性变量与时间字段
3. 系统执行趋势检测与漂移分析
4. 展示时间序列图并标注趋势线和漂移区间
5. 生成稳定性评估结论

#### 验收标准（规划）

- [ ] 能够检测数据中的显著趋势（上升/下降）
- [ ] 能够检测过程均值漂移和方差变化
- [ ] 结果以时间序列图的形式直观展示
- [ ] 提供明确的稳定性评估结论（稳定/不稳定及原因）

---

### 3.6 LLM 智能辅助

**模块状态：** 已实现（可选功能）

#### 功能描述

平台可选接入大语言模型（LLM），利用 AI 能力辅助用户完成分析的关键环节。LLM 功能为可选配置，平台在无 LLM 接入时仍可正常运行所有统计分析功能。

#### 支持的 LLM 服务商

| 服务商         | 说明                               |
| -------------- | ---------------------------------- |
| OpenAI         | GPT 系列模型                      |
| Claude         | Anthropic Claude 系列模型          |
| 智谱（Zhipu）  | 智谱 GLM 系列模型                  |
| 通义千问（Qwen）| 阿里云通义千问系列模型             |
| 自定义（Custom）| 支持自定义 API 端点与模型配置      |

#### LLM 辅助功能

| 功能         | 说明                                                   |
| ------------ | ------------------------------------------------------ |
| 意图提取     | 从用户的自然语言描述中提取分析意图和目标               |
| 方案生成     | 根据数据特征和分析意图自动生成统计分析方案             |
| 结论综合     | 将统计分析结果转化为通俗易懂的文字结论和建议           |

#### 用户流程

1. 用户在系统配置中选择 LLM 服务商并填入 API Key
2. 开启 LLM 辅助功能
3. 在分析过程中，系统在适当环节调用 LLM：
   - 分析开始前：提取用户意图，推荐分析方案
   - 分析完成后：综合结果生成文字结论
4. 用户可查看、编辑或采纳 LLM 生成的内容

#### 验收标准

- [ ] 支持配置 OpenAI、Claude、智谱、通义千问及自定义 5 种 LLM 服务商
- [ ] LLM 功能为可选项，关闭时不影响平台核心统计分析功能
- [ ] 意图提取能够从自然语言描述中正确识别分析目标
- [ ] 方案生成结果合理，能正确推荐统计方法
- [ ] 结论综合输出通顺、准确，符合统计学规范
- [ ] API Key 配置错误时给出明确错误提示

---

### 3.7 报告导出

**模块状态：** 已实现

#### 功能描述

用户在完成统计分析后，可将分析结果导出为标准格式的报告文件，便于分享、归档和汇报。

#### 导出格式

| 格式       | 文件类型         | 说明                                       |
| ---------- | ---------------- | ------------------------------------------ |
| Markdown   | `.zip`（含 `.md` + `.png`） | Markdown 文本报告，图表以 PNG 图片形式打包在 ZIP 压缩文件中 |
| DOCX       | `.docx`          | Microsoft Word 文档，图表以内联图片嵌入文档中 |

#### 报告内容

- 分析背景与目标描述
- 数据摘要（样本量、变量信息等）
- 统计方法说明
- 分析结果（统计量、p 值等关键指标）
- 可视化图表（PNG 格式）
- 结论与建议（若启用 LLM 则包含 AI 生成的结论）

#### 用户流程

1. 用户完成分析后，点击「导出报告」按钮
2. 选择导出格式（Markdown ZIP 或 DOCX）
3. 系统生成报告文件并提供下载

#### 验收标准

- [ ] Markdown 导出生成 ZIP 文件，内含 `.md` 文件和所有 `.png` 图表文件
- [ ] DOCX 导出生成 Word 文档，图表以内联图片正确嵌入
- [ ] 报告内容完整，包含分析目标、数据摘要、方法、结果、图表和结论
- [ ] 图表在导出文件中清晰可读，分辨率满足打印要求
- [ ] 中文内容在导出文件中正确显示，无乱码

---

### 3.8 会话管理

**模块状态：** 已实现

#### 功能描述

平台支持多会话管理，用户可创建多个独立的分析会话，每个会话保留完整的分析历史。支持会话的查看、过滤、恢复和软删除操作。

#### 核心功能

| 功能       | 说明                                             |
| ---------- | ------------------------------------------------ |
| 多会话支持 | 用户可同时维护多个独立的分析会话                 |
| 历史记录   | 每个会话保留完整的操作历史和分析结果             |
| 会话过滤   | 支持按时间、分析类型、行业分类等维度过滤会话     |
| 会话恢复   | 用户可恢复历史会话，继续未完成的分析             |
| 软删除     | 删除会话时采用软删除策略，数据不立即销毁，可恢复 |

#### 行业分类

平台支持 **9 个行业** 分类，用户可在创建会话时选择所属行业，以便获取行业相关的分析建议和模板：

1. 汽车制造
2. 电子电器
3. 医疗器械
4. 航空航天
5. 食品饮料
6. 化工材料
7. 半导体
8. 通用制造
9. 其他

#### 用户流程

1. 用户在会话列表中点击「新建会话」
2. 填写会话名称并选择行业分类
3. 在会话中进行数据上传和分析操作
4. 会话自动保存历史记录
5. 用户可随时返回会话列表查看、过滤或恢复历史会话

#### 验收标准

- [ ] 支持创建多个独立会话，会话间数据互不干扰
- [ ] 会话历史记录完整，包含每步操作和分析结果
- [ ] 会话过滤功能支持按时间、分析类型、行业分类筛选
- [ ] 已关闭的会话可成功恢复并继续分析
- [ ] 软删除后的会话可在回收区域恢复
- [ ] 9 个行业分类均可正常选择和关联

---

### 3.9 系统配置

**模块状态：** 已实现

#### 功能描述

平台提供系统级配置功能，用户可对 LLM 服务、UI 主题等进行个性化设置。

#### 配置项

| 配置项         | 说明                                               |
| -------------- | -------------------------------------------------- |
| LLM 服务商选择 | 选择 OpenAI、Claude、智谱、通义千问或自定义服务商   |
| API Key 配置   | 填入对应 LLM 服务商的 API Key                      |
| 自定义端点     | 配置自定义 LLM 服务的 API 端点地址                 |
| 深色主题       | 开启/关闭深色主题 UI                               |

#### 验收标准

- [ ] LLM 服务商切换后立即生效
- [ ] API Key 以密文形式存储和展示
- [ ] 深色主题切换流畅，所有页面元素适配正确
- [ ] 配置信息持久化存储，刷新页面后不丢失

---

## 4. 非功能性需求

### 4.1 性能要求

| 指标                 | 要求                                       |
| -------------------- | ------------------------------------------ |
| 文件上传响应         | 10MB 以内文件上传解析时间 ≤ 3 秒           |
| 统计分析响应         | 单次假设检验或 SPC 分析执行时间 ≤ 5 秒     |
| 图表渲染             | 控制图/统计图表渲染时间 ≤ 2 秒             |
| 报告导出             | 含图表的完整报告导出时间 ≤ 10 秒           |
| 并发会话             | 支持单用户同时维护 ≥ 20 个会话             |

### 4.2 安全要求

| 指标                 | 要求                                       |
| -------------------- | ------------------------------------------ |
| API Key 存储         | API Key 加密存储，前端展示时脱敏处理       |
| 数据隔离             | 会话间数据严格隔离，不可交叉访问           |
| 文件上传安全         | 限制上传文件类型和大小，防止恶意文件注入   |
| 软删除数据保留       | 软删除数据保留 30 天后自动清理             |

### 4.3 兼容性要求

| 指标                 | 要求                                       |
| -------------------- | ------------------------------------------ |
| 浏览器支持           | Chrome（最近 2 个大版本）、Edge、Firefox   |
| 屏幕分辨率           | 最低支持 1366×768，推荐 1920×1080          |
| 操作系统             | Windows 10+、macOS 12+、主流 Linux 发行版  |
| 深色/浅色主题        | 全部页面和组件均适配深色与浅色两种主题     |

---

## 5. 模块状态总览表

| 序号 | 模块名称         | 状态     | 核心能力概要                                              |
| ---- | ---------------- | -------- | --------------------------------------------------------- |
| 1    | 数据上传与预处理 | 已实现   | CSV/TXT/Excel 上传，GB18030 自动编码检测                  |
| 2    | 假设检验分析     | 已实现   | 9 种统计方法，6 步流程，Shapiro-Wilk 正态性检验，5 类图表，影响因子分析 |
| 3    | SPC 控制图分析   | 已实现   | 7 种控制图，8 条 Western Electric 判异规则，5 步流程，自动图表类型选择 |
| 4    | 过程能力分析     | 规划中   | Cp、Cpk、Pp、Ppk 过程能力指标计算                         |
| 5    | 稳定性分析       | 规划中   | 趋势检测、漂移分析                                        |
| 6    | LLM 智能辅助     | 已实现   | 5 种 LLM 服务商，意图提取、方案生成、结论综合             |
| 7    | 报告导出         | 已实现   | Markdown（ZIP + PNG）、DOCX（内联图片）                   |
| 8    | 会话管理         | 已实现   | 多会话、历史记录、过滤、恢复、软删除，9 个行业分类        |
| 9    | 系统配置         | 已实现   | LLM 配置、深色主题                                        |

---

*文档版本 V3.0 | 最后更新：2026-01-31*
